

```sql
CREATE TABLE `common_apm_server_inst` (
  `insert_time` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '时间',
  `update_time` timestamp NULL DEFAULT NULL ON UPDATE current_timestamp() COMMENT '服务器状态TTL时间',
  `instid` varchar(50) NOT NULL COMMENT '进程ID',
  `status` int(11) NOT NULL  COMMENT '状态',
  `osmem` bigint(20) NOT NULL COMMENT '内存',
  `osrelease` varchar(255) NOT NULL COMMENT '操作系统版本',
  `ostype` varchar(255) NOT NULL COMMENT '操作系统类型',
  `osplatform` varchar(255) NOT NULL,
  `osarch` varchar(255) NOT NULL COMMENT '服务器架构',
  `oscpus` text NOT NULL COMMENT 'CPU信息',
  `osnis` text NOT NULL COMMENT '网卡信息',
  `osendianness` varchar(255) NOT NULL,
  `hostname` varchar(255) NOT NULL COMMENT '主机名*',
  `instprofile` text DEFAULT NULL COMMENT '配置信息',
  `pmid` int(11) NOT NULL,
  `group` varchar(50) NOT NULL COMMENT '项目组',
  `pid` int(11) NOT NULL,
  `app` varchar(50) NOT NULL COMMENT '应用ID',
  `appname` varchar(255) NOT NULL,
  `coreversion` varchar(20) NOT NULL COMMENT '框架版本',
  `appversion` varchar(20) NOT NULL COMMENT '应用版本',
  `gittag` varchar(20) NOT NULL COMMENT 'gittag',
  `serverenv` text NOT NULL COMMENT '服务器环境变量',
  `serverip` varchar(50) NOT NULL COMMENT 'IP*',
  `docer_tags` varchar(1024) NOT NULL COMMENT 'docker tag',
  `tags` varchar(1024) NOT NULL COMMENT 'Tag*',
  `getdate` varchar(50) NOT NULL COMMENT '当前程序时间',
  `mysqldate` timestamp NOT NULL DEFAULT current_timestamp() COMMENT '当前数据库时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='服务进程';

CREATE TABLE `common_apm_web` (
  `insert_time` timestamp NOT NULL DEFAULT current_timestamp() COMMENT '时间',
  `instid` varchar(50) NOT NULL COMMENT '进程ID',
  `group` varchar(50) NOT NULL COMMENT '项目组',
  `app` varchar(50) NOT NULL COMMENT '应用ID',
  `pid` int(11) NOT NULL,
  `pmid` int(11) NOT NULL,
  `os_mem_total` bigint(20) NOT NULL COMMENT '操作系统总内存*',
  `os_mem_free` bigint(20) NOT NULL COMMENT '操作系统可用内存*',
  `p_cpu_1m_avg` float NOT NULL COMMENT '进程CPU使用率(1min)*',
  `p_mem_rss` bigint(20) NOT NULL,
  `p_mem_heap_total` bigint(20) NOT NULL COMMENT '进程堆栈内存',
  `p_mem_heap_used` bigint(20) NOT NULL COMMENT '进程堆栈已使用内存',
  `req_count` int(11) NOT NULL COMMENT '请求次数',
  `resp_count` int(11) NOT NULL COMMENT '响应次数',
  `resp_time_avg` int(11) NOT NULL COMMENT '平均响应耗时(ms)*',
  `resp_duration` int(11) NOT NULL COMMENT '累计耗时(ms)*',
  `resp_time_max` int(11) NOT NULL COMMENT '最大响应耗时(ms)*',
  `resp_time_min` int(11) NOT NULL,
  `resp_code_1xx` int(11) NOT NULL,
  `resp_code_2xx` int(11) NOT NULL COMMENT '2xx访问量(正确)*',
  `resp_code_3xx` int(11) NOT NULL COMMENT '3xx访问量(缓存)',
  `resp_code_4xx` int(11) NOT NULL COMMENT '4xx访问量(地址错误)*',
  `resp_code_5xx` int(11) NOT NULL COMMENT '5xx访问量(服务器错误)*'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='进程运行状态信息';

CREATE TABLE `common_apm_web_access_log` (
  `insert_time` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '时间',
  `instid` varchar(50) NOT NULL,
  `group` varchar(50) NOT NULL COMMENT '项目组',
  `app` varchar(50) NOT NULL COMMENT '应用ID',
  `pmid` int(11) NOT NULL,
  `pid` int(11) NOT NULL,
  `_id` varchar(50) NOT NULL,
  `sessionid` varchar(50) DEFAULT NULL COMMENT '会话ID',
  `remoteip` varchar(50) DEFAULT NULL COMMENT '用户IP*',
  `loginaccount` varchar(50) DEFAULT NULL COMMENT '用户帐号*',
  `tags` varchar(255) DEFAULT NULL,
  `url` varchar(255) DEFAULT NULL COMMENT '访问地址*',
  `header` varchar(4096) DEFAULT NULL,
  `params` text DEFAULT NULL,
  `src` varchar(50) DEFAULT NULL COMMENT '服务类型（Web,API）',
  `method` varchar(10) DEFAULT NULL COMMENT '请求方法',
  `duration` int(11) DEFAULT NULL COMMENT '响应耗时(ms)*',
  `contenttype` varchar(50) DEFAULT NULL,
  `type` varchar(50) DEFAULT NULL COMMENT '请求执行结果类型（finishid，error，timeout）',
  `statusCode` int(11) DEFAULT NULL COMMENT 'http状态码*',
  `finished` varchar(10) DEFAULT NULL COMMENT '是否响应客户端*',
  `size` int(11) DEFAULT NULL,
  `app_typeid` varchar(128) DEFAULT NULL COMMENT '模块编号*',
  `app_bizid` varchar(128) DEFAULT NULL COMMENT '业务ID*',
  `app_issueid` varchar(128) DEFAULT NULL COMMENT '开发任务ID*',
  `app_author` varchar(128) DEFAULT NULL COMMENT '开发者帐号*',
  `app_success` varchar(50) DEFAULT NULL COMMENT '是否成功*',
  `app_code` varchar(50) DEFAULT NULL COMMENT '应用状态码*',
  `app_tags` varchar(255) DEFAULT NULL,
  `dev_debug` varchar(2048) DEFAULT NULL,
  `btiming` varchar(255) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='用户访问记录';



CREATE TABLE `common_apm_app_log` (
  `insert_time` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '时间',
  `instid` varchar(50) NOT NULL,
  `group` varchar(50) NOT NULL COMMENT '项目组',
  `app` varchar(50) NOT NULL COMMENT '应用ID',
  `pmid` int(11) NOT NULL,
  `pid` int(11) NOT NULL,
  `_id` varchar(50) NOT NULL,
  `app_typeid` varchar(128) DEFAULT NULL COMMENT '模块编号*',
  `app_bizid` varchar(128) DEFAULT NULL COMMENT '业务ID*',
  `app_issueid` varchar(128) DEFAULT NULL COMMENT '开发任务ID*',
  `app_author` varchar(128) DEFAULT NULL COMMENT '开发者帐号*',
  `level` varchar(50) DEFAULT NULL COMMENT '日志级别',
  `tags` varchar(255) DEFAULT NULL COMMENT '日志Tags',
  `msg` varchar(2048) DEFAULT NULL COMMENT '消息'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='应用日志记录';

```
