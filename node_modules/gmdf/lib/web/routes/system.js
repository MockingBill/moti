var express = require('express');
var router = express.Router();

var system_service = require('../services/system_service');
var app_utils = require('../../common/utils/app_utils');

// 错误代码列表
var ecl = require('../ecl/system');

var routePrefix='/system';

//正则表达
var reg = /^[1-9]\d*|0$/;


/**
 *系统列表
 */
router.get('/list.do', async function (req, res, next) {
    try {
        let result = await system_service.pagingSystemList(req.query);
        app_utils.respJsonData(res, result);
    } catch (error) {
        app_utils.returnEclMsg(res,false,ecl,10,5100,error);
    }
});

router.post('/save.do',async function (req,res,next) {
    try{
        var mapEntity={};
        var field=req.body;
        for(var key in field){
            mapEntity[key]=field[key];
        }
        var result=await system_service.saveSystem(mapEntity);
        app_utils.returnEclMsg(res,true,ecl,11,2000,null);

    }catch (error){
        app_utils.returnEclMsg(res,false,ecl,11,5100,error);
    }
});

router.post('/modify.do',async function (req,res,next) {
    try{
        var id=req.body.id;
        console.log('id ===',id);
        if(!reg.test(id)){
            app_utils.returnEclMsg(res,false,ecl,12,5101,null);
            return;
        }
        var mapEntity={};
        var idmap={
            id:id
        };
        var field=req.body;
        for(var key in field){
            mapEntity[key]=field[key];
        }
        await system_service.updateSystemById(idmap,mapEntity);
        app_utils.returnEclMsg(res,true,ecl,12,2000,null);
    }catch (error){
        app_utils.returnEclMsg(res,false,ecl,12,5100,error);
    }
});





module.exports = router;