<style type="text/css">
    .downpanel .layui-select-title span{
        line-height: 38px;
    }
    .downpanel dl dd:hover{background-color: inherit;}
    .layui-layer-page .layui-layer-content { overflow: visible; }   /* 这句话用来控制下拉框长度，当下拉框长度超过弹出框时，可保证下拉框浮于弹出框上，避免弹窗出现滚动条*/
</style>


<br>
<h1>下拉框树</h1>
<form class="layui-form">
    <div class="layui-form-item">
        <label class="layui-form-label">上级机构<span style="color:red">*</span></label>
        <div class="layui-input-inline">
            <div class="layui-unselect layui-form-select downpanel" style="width:270%">
                <div class="layui-select-title">
                    <span class="layui-input layui-unselect" id="treeclass" ></span>
                    <input type="hidden" name="org_parent_id" id="org_parent_id">
                    <i class="layui-edge"></i>
                </div>
                <dl class="layui-anim layui-anim-upbit">
                    <dd>
                        <ul id="classtree"></ul>
                    </dd>
                </dl>
            </div>
        </div>
    </div>
</form>

<script type="text/javascript">
    layui.use(["tree"],function() {
        var $=layui.jquery,tree=layui.tree;
        $.ajax({
            url:'{{projcfg.base}}/org/tree.do',
            type:'get',
            //data:{'sysname':sys_name,'sysid':sys_id},
            success:function (res) {
                layui.tree({
                    elem:'#classtree',
                    nodes:JSON.parse(res.data),
                    click:function (node) {
                        $('#org_parent_id').val(node.id);
                        var $select=$($(this)[0].elem).parents(".layui-form-select");
                        $select.removeClass("layui-form-selected").find(".layui-select-title span").html(node.name);
                    }
                });
            }
        });

        $(".downpanel").on("click",".layui-select-title",function(e) {
            $(".layui-form-select").not($(this).parents(".layui-form-select")).removeClass("layui-form-selected");
            $(this).parents(".downpanel").toggleClass("layui-form-selected");
            layui.stope(e);
        }).on("click","dl i",function(e) {
            layui.stope(e);
        });
    });
</script>