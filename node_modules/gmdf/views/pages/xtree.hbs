
<div class="layui-container">
    <div class="layui-row">
        <div class="layui-col-md6" style="width: 300px">
            <form class="layui-form">
                <div id="roletree" style="width:300px;height:600px;border:0px;overflow:auto;">
                </div>
            </form>
        </div>

        <div class="layui-col-md6">
            <blockquote class="layui-elem-quote news_search">
                <div class="layui-inline">
                    <a class="layui-btn layui-btn-primary toAuthority_btn"><i class="layui-icon">&#xe620;</i>获取选中的节点</a>
                </div>
            </blockquote>
        </div>
    </div>
</div>


<!--引入xtree-->
<script type="text/javascript" src="static/js/xtree/layui-xtree.js"></script>

<script>

    layui.use(['form','jquery','tree','layer'], function(){
        var form = layui.form;
        var $ = layui.$;
        var layer=layui.layer;

        //获取菜单树形目录
        var xtree;

        var treeNode=[
            {   "title":"root",
                "value":1,
                "data":[
                    {   "title":"管理控制台",
                       "value":"管理控制台",
                        "checked":1,
                        "data":[
                            {   "title":"系统管理",
                               "value":"系统管理",
                                "checked":1,
                                "data":[]},
                            {   "title":"菜单管理",
                               "value":"菜单管理",
                                "checked":1,
                                "data":[]},
                            {   "title":"角色管理",
                               "value":"角色管理",
                                "checked":1,
                                "data":[]},
                            {   "title":"部门管理",
                               "value":"部门管理",
                                "checked":1,
                                "data":[]},
                            {   "title":"人员管理",
                               "value":"人员管理",
                                "checked":1,
                                "data":[]},
                            {   "title":"操作示例",
                               "value":"操作示例",
                                "checked":1,
                                "data":[
                                    {   "title":"crud操作",
                                       "value":"crud操作",
                                        "checked":1,
                                        "data":[]},
                                    {   "title":"xtree操作",
                                       "value":"xtree操作",
                                        "checked":1,
                                        "data":[]}]},
                            {   "title":"字典管理",
                               "value":"字典管理",
                                "checked":1,
                                "data":[]},
                            {   "title":"参数管理",
                               "value":"参数管理",
                                "checked":1,
                                "data":[]}]},
                    {   "title":"导航一",
                       "value":"导航一",
                        "checked":1,
                        "data":[]},
                    {   "title":"导航二",
                       "value":"导航二",
                        "checked":1,
                        "data":[]},
                        ]}];

        xtree=new layuiXtree({
            elem:'roletree',
            form:form,
            data:treeNode,
        });

        //追踪叶子到根节点的目录
        function getOptList(list,value) {
            list.push(value);
            if(xtree.GetParent(value)&&xtree.GetParent(value).value==1){
                return list
            }else{
                getOptList(list,xtree.GetParent(value).value);
            }
        }

        //设置权限
        $(".toAuthority_btn").click(function () {
                var checkNode=xtree.GetChecked();
                var leaf=[];
                var role_opt_list=[];

                for(var i in checkNode){
                    leaf.push(checkNode[i].value);
                }

                for(var i in leaf){
                    getOptList(role_opt_list,leaf[i]);
                }

                var role_opt_set=new Set(role_opt_list);

                var sendData=[];
                for(var s of role_opt_set){
                    sendData.push(s);
                }

                layer.msg('选择的节点  : '+sendData,{
                    time:10000,
                    btn:['知道了']
                })
        });
    });
</script>